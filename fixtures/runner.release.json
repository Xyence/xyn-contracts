{
  "apiVersion": "xyn.seed/v1",
  "kind": "Release",
  "metadata": {
    "name": "runner",
    "namespace": "core",
    "labels": {
      "app": "runner",
      "owner": "xyn-seed"
    }
  },
  "backend": {
    "type": "compose"
  },
  "components": [
    {
      "name": "runner-api",
      "image": "xyence/xyn-runner-api:git-b56708f",
      "ports": [
        { "name": "http", "containerPort": 8088, "hostPort": 8088, "protocol": "tcp" }
      ],
      "env": {
        "RUNNER_QUEUE_URL": "redis://runner-redis:6379/0",
        "RUNNER_WORKSPACE": "/workspace",
        "RUNNER_LOG_LEVEL": "info",
        "RUNNER_REDIS_URL": "redis://runner-redis:6379/0",
        "RUNNER_QUEUE_NAME": "default"
      },
      "volumeMounts": [
        { "volume": "runner-workspace", "mountPath": "/workspace" }
      ]
    },
    {
      "name": "runner-worker",
      "image": "xyence/xyn-runner-worker:git-b56708f",
      "env": {
        "RUNNER_REDIS_URL": "redis://runner-redis:6379/0",
        "RUNNER_QUEUE_NAME": "default",
        "RUNNER_WORKSPACE": "/workspace",
        "RUNNER_LOG_LEVEL": "info"
      },
      "volumeMounts": [
        { "volume": "runner-workspace", "mountPath": "/workspace" }
      ],
      "dependsOn": ["runner-redis"]
    },
    {
      "name": "runner-redis",
      "image": "redis:7-alpine",
      "healthcheck": {
        "test": ["CMD", "redis-cli", "ping"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 5
      },
      "ports": [
        { "name": "redis", "containerPort": 6379, "hostPort": 6379, "protocol": "tcp" }
      ]
    }
  ],
  "volumes": [
    { "name": "runner-workspace", "type": "dockerVolume" }
  ],
  "networks": [
    { "name": "runner-net", "type": "dockerNetwork" }
  ]
}
